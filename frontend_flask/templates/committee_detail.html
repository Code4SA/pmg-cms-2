{% extends "base.html" %}

{% block style %}
<style>
  .member-profile-pic{
    max-width: 50px;
    max-height: 75px;
  }

  .member-profile-pic.chairperson{
    max-width: 100px;
    max-height: 150px;
  }
</style>
{% endblock %}

{% block top_links %}
{{ super() }}
{% endblock %}

{% block page %}
<div class="col-sm-12">
  <h4 class="light-red">{{ committee.house.name }} committee</h4>
  <h1>{{ committee.name }}</h1>
  {% if committee.contact_details %}
  <h5>
    {{ committee.contact_details }}
  </h5>
  {% endif %}
</div>

<div class="col-md-4">
  <h3><span class="glyphicon glyphicon-flash"></span> Committee meetings</h3>

  {%- set per_page = 20 -%}
  {%- set num_pages = ((committee.events | length) / per_page) | int -%}
  {%- if (committee.events | length) % per_page != 0 %}
  {% set num_pages = num_pages + 1 %}
  {% endif -%}
  
  <div class="tab-content">
    {% for i in range(num_pages) %}
    <div class="tab-pane fade{% if loop.first %} in active{% endif %}" id="page-{{ loop.index }}">
      <table class="table table-striped table-bordered">
        {% if loop.last %}
        {% set event_list = committee.events[loop.index0 * 20::] %}
        {% else %}
        {% set event_list = committee.events[loop.index0 * 20:loop.index * 20] %}
        {% endif %}
        {% for event in event_list %}
        {% if event.type == "committee-meeting" %}
        <tr>
          <td><nobr>{{ event.date | pretty_date }}</nobr></td>
          <td><a href="{{ url_for('committee_meeting', event_id=event.id) }}">{{ event.title }}</a></td>
        </tr>
        {% endif %}
        {% endfor %}
      </table>
    </div>
    {% endfor %}
  </div>

  <ul class="pagination pagination-sm" role="tablist" style="margin-top: -14px">
    <li><a href="#page-1" role="tab" data-toggle="tab">&laquo;</a></li>
    {% for i in range(num_pages) %}
    <li{% if loop.first %} class="active"{% endif %}><a href="#page-{{ loop.index }}" role="tab" data-toggle="tab">{{ loop.index }}</a></li>
    {% endfor %}
    <li><a href="#page-{{ num_pages }}" role="tab" data-toggle="tab">&raquo;</a></li>
  </ul>
</div> <!-- /Reports -->

<div class="col-md-4">
  <h3><span class="glyphicon glyphicon-user"></span> Members</h3>
  {% if committee.memberships %}
  {% set break = 0.5 * committee.memberships | length %}
  {% set break = break | int %}
  <div class="col-sm-6">
    <ul class="list-unstyled list-spaced">

      {% for membership in committee.memberships[0:break] %}
      {% set member = membership.member %}
      <li class="clearfix">
      {%- if member.profile_pic_url %}
      <img class="member-profile-pic{% if membership.type == 'chairperson'%} chairperson{% endif %}" src="{{ member.profile_pic_url }}" alt="Profile picture: {{ member.name }}" >
      {% else %}
      <p class="text-muted">No image available</p>
      {% endif %}
      <h4>{{ member.name }}</h4>
      {% if membership.type == "chairperson"%}<div class="label label-success">Chairperson</div>{% endif %}
        {% if member.party %}
        <span>{{ member.party.name }}</span>
        {% endif %}
      </li>
      {% endfor %}

    </ul>
  </div>
  <div class="col-sm-6">
    <ul class="list-unstyled list-spaced">
      {% for membership in committee.memberships[break::] %}
      {% set member = membership.member %}
      <li class="clearfix">
        <img class="member-profile-pic" src="{{ member.profile_pic_url }}" alt="Profile picture: {{ member.name }}" >
        <h4>{{ member.name }}</h4>
        {% if member.party %}
        <span>{{ member.party.name }}</span>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </div>
  {% else %}
  <p class="lead">We don't have membership info for this committee.</p>
  {% endif %}
</div>  <!-- /Members -->


<div class="col-md-4">
  {% if committee.tabled_committee_reports %}
  <h3><span class="glyphicon glyphicon-bullhorn"></span> Tabled Reports</h3>
  <ul class="list-unstyled list-spaced">
  {% for result in committee.tabled_committee_reports[0:5] %}
  {% include 'tabled_committee_report_stub.html' %}
  {% endfor %}
  </ul>
  {% endif %}
  {% if committee.calls_for_comment %}
  <h3><span class="glyphicon glyphicon-bullhorn"></span> Calls for Comment</h3>
  <ul class="list-unstyled list-spaced">
  {% for result in committee.calls_for_comment[0:5] %}
  {% include 'calls_for_comment_stub.html' %}
  {% endfor %}
  </ul>
  {% endif %}
</div> <!-- /Calls for comments -->

{% endblock %}

